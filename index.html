<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Mémento opérationnel IA – RCH</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Police Inter -->
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">

  <!-- Styles de l'application -->
  <link rel="stylesheet" href="style.css" />

  <!-- Lib pour scan QR (caméra + fichier) -->
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>

  <!-- Lib pour QR code en création -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

  <!-- Lib pour compression (pako) -->
  <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
</head>
<body>
  <div class="app-root">

    <header class="app-header">
      <div class="header-left">
        <img src="ensosp-logo.png" alt="Logo ENSOSP" class="logo-ensosp" />
        <div>
          <div class="header-title-main">Mémento opérationnel IA – RCH</div>
          <div class="header-title-sub">Outil expérimental — Génération de prompts assistés</div>
        </div>
      </div>
      <div class="header-right">
        <span class="chip chip--info">Version 0.4.3</span>
      </div>
    </header>

    <main class="app-main">
      <div class="tabs">
        <button class="tab-button tab-button--active" data-tab="scan">
          Lecture de fiche
        </button>
        <button class="tab-button" data-tab="create">
          Création de fiche
        </button>
      </div>

      <!-- === Onglet : Lecture / Scan === -->
      <section class="tab-panel tab-panel--active" id="tab-scan">
        <div class="cards-layout">

          <!-- Colonne gauche -->
          <div class="card">
            <div class="card-section">
              <div class="button-row">
                <button id="cameraBtn" class="btn btn-primary">
                  Activer la caméra
                </button>
                <button id="resetBtn" class="btn btn-secondary">
                  Réinitialiser
                </button>
              </div>

              <div id="cameraError" class="alert alert-error" hidden></div>

              <div id="videoBox" class="video-box" hidden>
                <div id="camera" class="camera-view"></div>
              </div>

              <div class="file-input-row">
                <label for="qrFile" class="file-label">
                  Importer un QR code (image)
                </label>
                <input type="file" id="qrFile" accept="image/*" />
              </div>
            </div>

            <div class="card-section">
              <label for="infosComplementaires" class="section-label">
                Informations complémentaires (facultatif)
              </label>
              <textarea
                id="infosComplementaires"
                class="textarea textarea--large"
                placeholder="Ex : contexte opérationnel, contraintes particulières, etc."
              ></textarea>
            </div>
          </div>

          <!-- Colonne droite -->
          <div class="card">
            <div class="card-section">
              <div id="ficheMeta" class="fiche-meta fiche-meta--empty">
                Aucune fiche scannée
              </div>
            </div>

            <div class="card-section">
              <div id="variablesContainer" class="variables-container"></div>
            </div>

            <div class="card-section">
              <label for="compiledPrompt" class="section-label">
                Prompt généré
              </label>
              <textarea
                id="compiledPrompt"
                class="textarea textarea--prompt"
                readonly
              ></textarea>

              <div class="button-row button-row--end">
                <button id="generatePromptBtn" class="btn btn-primary">
                  Actualiser le prompt
                </button>
              </div>

              <div class="ia-buttons-row">
                <button id="btnChatgpt" class="btn btn-ia" disabled>
                  Ouvrir dans ChatGPT
                </button>
                <button id="btnPerplexity" class="btn btn-ia" disabled>
                  Ouvrir dans Perplexity
                </button>
                <button id="btnMistral" class="btn btn-ia" disabled>
                  Ouvrir dans Mistral
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- === Onglet : Création de fiche === -->
      <section class="tab-panel" id="tab-create">
        <div class="cards-layout cards-layout--stacked">

          <div class="card">
            <div class="card-section card-section--horizontal">
              <div class="form-column">
                <h2 class="section-title">Métadonnées de la fiche</h2>

                <div class="form-group">
                  <label for="ficheTitre" class="section-label">Titre de la fiche</label>
                  <input id="ficheTitre" class="input" type="text" placeholder="Ex : Analyse produit" />
                </div>

                <div class="form-group">
                  <label for="ficheCategorie" class="section-label">Catégorie</label>
                  <input id="ficheCategorie" class="input" type="text" placeholder="Ex : Analyse, Zone, Conduite à tenir" />
                </div>

                <div class="form-group">
                  <label for="ficheVersion" class="section-label">Version</label>
                  <input id="ficheVersion" class="input" type="text" placeholder="Ex : V0, V1.0" />
                </div>

                <div class="form-group">
                  <label for="ficheObjectif" class="section-label">Objectif</label>
                  <textarea id="ficheObjectif" class="textarea" placeholder="Décrire l'objectif opérationnel de la fiche"></textarea>
                </div>

                <div class="form-group">
                  <label for="ficheReferences" class="section-label">
                    Références bibliographiques / sources
                  </label>
                  <textarea
                    id="ficheReferences"
                    class="textarea"
                    placeholder="Sources officielles, documents de référence..."
                  ></textarea>
                </div>
              </div>

              <div class="form-column">
                <h2 class="section-title">Champs d'entrée</h2>

                <div id="variablesCreateContainer" class="variables-create-container"></div>

                <div class="button-row">
                  <button id="addVariableBtn" class="btn btn-secondary">
                    Ajouter un champ
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-section card-section--horizontal">
              <div class="form-column">
                <h2 class="section-title">Prompt brut</h2>
                <textarea
                  id="promptBrut"
                  class="textarea textarea--prompt"
                  placeholder="Écrire ici le prompt en intégrant les champs définis ci-dessus..."
                ></textarea>
              </div>

              <div class="form-column">
                <h2 class="section-title">JSON généré</h2>
                <textarea
                  id="jsonOutput"
                  class="textarea textarea--code"
                  readonly
                ></textarea>

                <div class="button-row">
                  <button id="generateJsonBtn" class="btn btn-primary">
                    Générer le JSON
                  </button>
                  <button id="copyJsonBtn" class="btn btn-secondary" disabled>
                    Copier le JSON
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-section card-section--horizontal">
              <div class="form-column">
                <h2 class="section-title">QR code de la fiche</h2>
                <p class="helper-text">
                  Le QR code encode un JSON compact, éventuellement compressé.
                  Il est lisible par l’onglet « Lecture de fiche » du présent outil.
                </p>
                <div id="qrPreview" class="qr-preview">
                  <h3 class="section-subtitle">QR code</h3>
                  <div id="generatedQr"></div>
                  <button id="downloadQrBtn" class="btn btn-secondary" disabled>
                    Télécharger le QR code
                  </button>
                </div>
              </div>
            </div>
          </div>

        </div>
      </section>

    </main>

    <footer class="app-footer">
      © ENSOSP — Cne Eddy Fischer – Cdt Anne Tirelle — v0.4.3
    </footer>
  </div>

  <script src="app.js"></script>
</body>
</html>
